# 階段蛻變模式規格文檔

## 模式概述

階段蛻變模式是走走小日模擬器的一個進階遊戲模式，通過階段性的評估和狀態系統，讓玩家體驗更深層的角色成長和人格發展。

## 設計目的

1. **階段性成長體驗** - 每 5 個事件為一個階段，讓玩家有明確的成長節點
2. **狀態系統** - 根據表現獲得持續性狀態，影響後續選擇
3. **策略性思考** - 玩家需要考慮當前階段的表現對下個階段的影響
4. **深度角色發展** - 通過狀態系統塑造獨特的人格特質

## 核心機制

### 階段系統

- **階段結構**: 每 5 個事件為一個階段
- **階段標記**: 1-1, 1-2, 1-3... (主階段-子階段)
- **階段轉換**: 完成 5 個事件後自動觸發階段評估

### 階段評估

- **統計計算**: 計算該階段內的平均屬性變化
- **表現分析**: 根據選擇模式分析玩家傾向
- **建議生成**: 提供下階段的改進建議

### 狀態系統 (計劃中)

- **狀態獲得**: 根據階段表現獲得持續性狀態
- **狀態效果**: 狀態會影響後續選項的效果
- **狀態持續**: 狀態會持續到下一個階段結束

## 技術實現

### 文件結構

```
src/
├── types/game.ts                    # 添加階段相關類型定義
├── contexts/GameContext.tsx         # 階段邏輯和狀態管理
├── app/components/game/
│   ├── GameScreen.tsx              # 階段模式UI集成
│   └── StageEvaluationScreen.tsx   # 階段評估頁面
```

### 核心類型

```typescript
// 階段狀態
interface StageState {
  currentStage: number; // 當前主階段
  currentSubStage: number; // 當前子階段
  eventsInCurrentStage: number; // 階段內事件數
  stageHistory: StageResult[]; // 階段歷史
}

// 階段結果
interface StageResult {
  stage: number; // 階段號
  subStage: number; // 子階段號
  events: EventResult[]; // 階段內事件
  averageStats: Partial<PlayerStats>; // 平均屬性變化
  gainedStatus: PlayerStatus[]; // 獲得狀態
  timestamp: number; // 時間戳
}

// 玩家狀態
interface PlayerStatus {
  id: string; // 狀態ID
  name: string; // 狀態名稱
  description: string; // 狀態描述
  effects: StatusEffect[]; // 狀態效果
  duration: number; // 持續階段數
}
```

## 開發進度

### ✅ 已完成

1. **基礎架構** (100%)

   - 階段計算邏輯
   - 階段狀態管理
   - 階段轉換檢測

2. **階段評估頁面** (100%)

   - 階段統計顯示
   - 平均屬性變化計算
   - 階段建議生成
   - UI 界面完成

3. **階段評估觸發** (100%)
   - 每 5 個事件後自動觸發
   - 正確計算階段事件數量
   - 階段評估頁面顯示

### 🔄 進行中

- 無

### 📋 待開發

1. **狀態獲得邏輯** (0%)

   - 根據階段表現決定獲得狀態
   - 狀態獲得條件設計
   - 狀態效果定義

2. **狀態效果實現** (0%)

   - 狀態對選項效果的影響
   - 狀態持續性管理
   - 狀態疊加和衝突處理

3. **體力恢復機制** (0%)

   - 階段結束時自動恢復體力
   - 恢復量根據表現調整
   - 階段模式下的體力消耗調整

4. **狀態 UI 顯示** (0%)
   - 當前活躍狀態顯示
   - 狀態效果提示
   - 狀態持續時間顯示

## 下一步計劃

### 短期目標 (1-2 天)

1. **實現狀態獲得邏輯**

   - 設計狀態獲得條件
   - 實現狀態計算算法
   - 測試狀態獲得機制

2. **實現基礎狀態效果**
   - 實現"內耗"狀態 (心情-1)
   - 實現"神采奕奕"狀態 (心情+1)
   - 測試狀態效果

### 中期目標 (3-5 天)

1. **完善狀態系統**

   - 實現所有計劃的狀態
   - 狀態疊加和衝突處理
   - 狀態 UI 顯示

2. **體力恢復機制**
   - 階段結束體力恢復
   - 階段模式體力消耗調整
   - 平衡性調整

### 長期目標 (1 週後)

1. **模式平衡性**

   - 調整狀態獲得條件
   - 平衡狀態效果強度
   - 優化遊戲體驗

2. **擴展功能**
   - 階段成就系統
   - 階段歷史回顧
   - 模式專屬事件

## 狀態設計 (計劃)

### 負面狀態

- **內耗**: 心情持續-1
- **疲憊**: 體力消耗加倍
- **焦慮**: 決斷力下降
- **社交恐懼**: 社交選項效果減弱

### 正面狀態

- **神采奕奕**: 心情持續+1
- **陽光**: 社交選項效果增強
- **專注**: 專注力相關選項效果增強
- **穩健**: 穩定性相關選項效果增強

## 技術注意事項

1. **性能考慮**: 階段評估計算需要優化
2. **狀態管理**: 狀態疊加和衝突需要仔細處理
3. **數據一致性**: 確保階段計算的準確性
4. **用戶體驗**: 階段評估頁面需要流暢的過渡

## 測試計劃

1. **階段計算測試**: 確保階段轉換正確
2. **狀態效果測試**: 驗證狀態對選項的影響
3. **平衡性測試**: 確保模式不會過於困難或簡單
4. **用戶體驗測試**: 確保階段評估流程順暢
