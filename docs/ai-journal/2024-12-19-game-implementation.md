# 2024-12-19 對話式遊戲模擬器實作日誌

## 專案概述

將原本的 landing page 專案改造成對話式人生模擬器，基於 Next.js 15 + Chakra UI v3 技術棧。

## 已完成的核心功能

### 1. 資料結構設計 ✅

#### TypeScript 介面定義 (`src/types/game.ts`)

- **PlayerStats**: 玩家屬性介面，包含基礎數值（心情、儲蓄、體力）和人格特質（7 個維度）
- **Event**: 事件介面，包含事件描述和多個選項
- **EventOption**: 選項介面，定義選項文字和數值變化
- **EventResult**: 事件結果記錄
- **PersonalityLabels**: 人格標籤系統
- **STAT_LIMITS**: 數值限制常數，定義各屬性的上下限

#### 初始資料

- 初始玩家屬性：心情 80、儲蓄 1000、體力 70，其他人格特質為 0
- 人格標籤對應表：根據數值範圍顯示不同的人格傾向
- 示例事件：便利商店耳機男、同事生日派對

#### 數值限制系統 ✅

- **心情**: 0-100 範圍，歸零時強制休息
- **體力**: 0-100 範圍，歸零時強制休息
- **儲蓄**: 0-9999 範圍，歸零時無法進行購物事件
- **人格特質**: -10 到 +10 範圍

### 2. 狀態管理系統 ✅

#### GameContext (`src/contexts/GameContext.tsx`)

- 使用 React Context + useReducer 管理遊戲狀態
- 支援的動作：START_GAME、SELECT_OPTION、NEXT_EVENT、RESET_GAME、START_REST、END_REST
- 自動數值計算和邊界處理（根據 STAT_LIMITS 限制）
- 事件歷史記錄功能
- **休息機制**: 心情或體力歸零時自動觸發休息狀態

#### 休息系統 ✅

- **觸發條件**: 心情 ≤ 0 或體力 ≤ 0
- **休息效果**: 心情 +30、體力 +50
- **休息畫面**: 專門的 RestScreen 元件
- **自動恢復**: 休息後自動進入下一個事件

### 3. UI 元件實作 ✅

#### StatsDisplay (`src/app/components/game/StatsDisplay.tsx`)

- 屬性面板顯示，分為基礎數值和人格特質兩區塊
- 進度條視覺化（心情、體力、儲蓄）
- 人格標籤即時顯示
- 響應式網格佈局
- **警告系統**: 當數值過低時顯示警告訊息

#### EventDisplay (`src/app/components/game/EventDisplay.tsx`)

- 事件標題和描述展示
- 選項按鈕列表
- 載入狀態處理
- 美觀的卡片式設計

#### GameScreen (`src/app/components/game/GameScreen.tsx`)

- 四種遊戲狀態：開始畫面、遊戲進行中、休息畫面、結束畫面
- 左右分欄佈局：屬性面板 + 事件顯示
- 遊戲進度指示器
- 重新開始功能

#### RestScreen (`src/app/components/game/RestScreen.tsx`) ✅

- 專門的休息畫面設計
- 顯示當前狀態和恢復效果
- 橙色主題的視覺設計
- 休息按鈕觸發恢復機制

### 4. 遊戲流程 ✅

#### 基本遊戲循環

1. 開始畫面 → 點擊開始遊戲
2. 顯示第一個事件 → 玩家選擇選項
3. 自動計算屬性變化 → 檢查是否需要休息
4. 如需休息 → 顯示休息畫面 → 恢復後繼續
5. 事件結束 → 顯示結束畫面

#### 數值變化機制

- 選項會影響多個屬性
- 自動邊界處理（根據 STAT_LIMITS）
- 即時視覺反饋
- 警告系統提醒玩家狀態

#### 休息機制 ✅

- **自動檢測**: 每次選擇後檢查心情和體力
- **強制休息**: 任一數值歸零時無法繼續遊戲
- **視覺反饋**: 紅色顯示歸零的數值
- **恢復效果**: 休息後大幅提升心情和體力

## 技術實現細節

### Chakra UI v3 適配

- 修正 API 使用方式：`spacing` → `gap`
- 自定義進度條元件（替代 Progress 元件）
- 正確的 Button loading 屬性
- 自定義警告元件（替代 Alert 元件）

### 型別安全

- 完整的 TypeScript 介面定義
- 嚴格的型別檢查
- 避免 any 型別使用
- 數值限制常數確保型別安全

### 元件化設計

- 高內聚、低耦合的元件結構
- 可重用的 UI 元件
- 清晰的 props 介面
- 專門的休息畫面元件

## 目前遊戲內容

### 示例事件

1. **便利商店耳機男** (EVT001)

   - 選項 A：拍拍他提醒 → 心情-2、體力-1、決斷力+1、同理心+1
   - 選項 B：默默等待 → 心情-1、穩定性+1

2. **同事生日派對** (EVT002)
   - 選項 A：參加派對 → 心情+3、體力-5、社交傾向+2、同理心+1
   - 選項 B：婉拒休息 → 心情+1、體力+3、穩定性+1、社交傾向-1

### 數值限制規則

- **心情/體力**: 0-100，歸零強制休息
- **儲蓄**: 0-9999，歸零無法購物
- **人格特質**: -10 到 +10，影響標籤顯示
- **警告系統**: 心情/體力 ≤ 20 或儲蓄 ≤ 100 時顯示警告

## 開發環境

- **Port**: 3001 (3000 被佔用)
- **URL**: http://localhost:3001
- **狀態**: 基本功能完成，包含休息機制，可正常運行

## 下一步規劃

### Phase 2: 進階功能

1. **更多事件內容** - 擴充事件資料庫
2. **條件檢查機制** - 基於屬性值限制選項（如儲蓄不足時隱藏購物選項）
3. **分支劇情** - 根據歷史選擇影響後續事件
4. **動畫效果** - 使用 Framer Motion 增強體驗

### Phase 3: 優化體驗

1. **音效和視覺反饋** - 選擇時的動畫效果
2. **統計分析** - 選擇傾向分析
3. **存檔系統** - 遊戲進度保存
4. **成就系統** - 特殊選擇記錄

## 技術債務

- 需要處理 Chakra UI v3 的 API 變化
- 考慮使用 Zustand 替代 Context 以提升性能
- 事件資料應該從外部檔案載入
- 需要加入錯誤邊界處理
- 可以加入更多的事件條件檢查（如儲蓄門檻）

---

**實作時間**: 2024-12-19  
**狀態**: 基本功能完成，包含數值限制和休息機制，可正常運行  
**下一步**: 擴充事件內容和優化使用者體驗
