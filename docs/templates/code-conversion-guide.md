# 事件程式碼轉換指南

## 轉換流程

### 1. 檢查企劃表格

確保企劃填寫的表格包含所有必要資訊：

- [ ] 事件基本資訊完整
- [ ] 所有選項的數值都已填寫
- [ ] 條件限制格式正確
- [ ] 後果描述簡潔明瞭

### 2. 轉換為 TypeScript 格式

#### 基本結構轉換

```typescript
{
  id: "事件ID",
  name: "事件名稱",
  description: "事件描述",
  scene: "場景背景圖",
  category: EVENT_CATEGORIES.分類,
  difficulty: EVENT_DIFFICULTY.難度,
  tags: ["標籤1", "標籤2", "標籤3"],
  options: {
    // 選項內容
  }
}
```

#### 選項轉換

```typescript
A: {
  text: "選項文本",
  statChanges: {
    // 只包含非零的數值
    心情: 數值,
    體力: 數值,
    儲蓄: 數值,
    專注力: 數值,
    時間感: 數值,
    社交傾向: 數值,
    決斷力: 數值,
    好奇心: 數值,
    同理心: 數值,
    穩定性: 數值,
  },
  conditions: [
    // 條件限制（如果有）
    { stat: "屬性名", operator: "gte", value: 數值 }
  ],
  consequences: ["後果描述"],
}
```

### 3. 數值處理規則

#### 只包含非零數值

- 如果某個屬性的影響為 0，則不包含在 `statChanges` 中
- 例如：如果心情影響為 0，則不寫 `心情: 0`

#### 條件限制轉換

- `決斷力 ≥ 2` → `{ stat: "決斷力", operator: "gte", value: 2 }`
- `社交傾向 ≥ 0` → `{ stat: "社交傾向", operator: "gte", value: 0 }`
- `儲蓄 ≥ 100` → `{ stat: "儲蓄", operator: "gte", value: 100 }`

#### 操作符對應

- `≥` → `"gte"`
- `≤` → `"lte"`
- `=` → `"eq"`
- `>` → `"gt"`
- `<` → `"lt"`

### 4. 完整轉換範例

#### 企劃表格

```
事件 ID: COMMUTE002
事件名稱: 早餐的選擇
事件描述: 路過早餐店，你聞到香噴噴的味道，但時間有點緊。
場景背景圖: 早餐店門口
分類: COMMUTE
難度: EASY
標籤: 早餐、時間、健康

選項 A:
- 選項文本: 買個早餐，慢慢享用。
- 心情影響: 0
- 體力影響: +12
- 儲蓄影響: -80
- 時間感影響: -2
- 其他特質: 0
- 條件限制: 無
- 後果描述: 你享受了一頓美味的早餐，心情愉悅，但到公司時有點趕。
```

#### 轉換後的程式碼

```typescript
{
  id: "COMMUTE002",
  name: "早餐的選擇",
  description: "路過早餐店，你聞到香噴噴的味道，但時間有點緊。",
  scene: "早餐店門口",
  category: EVENT_CATEGORIES.COMMUTE,
  difficulty: EVENT_DIFFICULTY.EASY,
  tags: ["早餐", "時間", "健康"],
  options: {
    A: {
      text: "買個早餐，慢慢享用。",
      statChanges: {
        體力: 12,
        時間感: -2,
        儲蓄: -80,
      },
      consequences: ["你享受了一頓美味的早餐，心情愉悅，但到公司時有點趕。"],
    },
  },
}
```

### 5. 常見轉換錯誤

#### ❌ 錯誤範例

```typescript
// 錯誤：包含零值
statChanges: {
  心情: 0,  // 不應該包含
  體力: 12,
  儲蓄: -80,
}

// 錯誤：條件格式錯誤
conditions: [
  { stat: "決斷力", operator: ">=", value: 2 }  // 應該是 "gte"
]

// 錯誤：後果描述格式錯誤
consequences: "你享受了一頓美味的早餐"  // 應該是陣列
```

#### ✅ 正確範例

```typescript
// 正確：只包含非零值
statChanges: {
  體力: 12,
  儲蓄: -80,
}

// 正確：條件格式
conditions: [
  { stat: "決斷力", operator: "gte", value: 2 }
]

// 正確：後果描述格式
consequences: ["你享受了一頓美味的早餐"]
```

### 6. 驗證檢查清單

轉換完成後，請檢查：

- [ ] 所有數值都是整數
- [ ] 心情/體力數值在 -15 到 +15 範圍內
- [ ] 儲蓄數值在 -200 到 +200 範圍內
- [ ] 特質數值在 -3 到 +3 範圍內
- [ ] 沒有包含零值的屬性
- [ ] 條件限制格式正確
- [ ] 後果描述是陣列格式
- [ ] 事件 ID 格式正確（CATEGORY + 三位數字）

### 7. 檔案位置

轉換完成的事件應該添加到：

```
src/data/events/commute.ts  // 通勤事件
src/data/events/social.ts   // 社交事件（如果存在）
src/data/events/work.ts     // 工作事件（如果存在）
```

### 8. 測試建議

- 在開發者模式下測試新事件
- 檢查所有選項的數值影響是否正確
- 驗證條件限制是否正常工作
- 確認後果描述顯示正常

---

**轉換完成後，請將新事件添加到相應的事件檔案中，並更新事件管理器。**
